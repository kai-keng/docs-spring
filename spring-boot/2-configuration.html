<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置文件实战 | Java</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Just record my learning process">
    <link rel="preload" href="/java-learning/assets/css/0.styles.dcc29016.css" as="style"><link rel="preload" href="/java-learning/assets/js/app.ac2a67bc.js" as="script"><link rel="preload" href="/java-learning/assets/js/2.008936f0.js" as="script"><link rel="preload" href="/java-learning/assets/js/27.9d817416.js" as="script"><link rel="prefetch" href="/java-learning/assets/js/10.297963c4.js"><link rel="prefetch" href="/java-learning/assets/js/11.83e1f062.js"><link rel="prefetch" href="/java-learning/assets/js/12.be4ac7de.js"><link rel="prefetch" href="/java-learning/assets/js/13.50f4db4f.js"><link rel="prefetch" href="/java-learning/assets/js/14.1ea833da.js"><link rel="prefetch" href="/java-learning/assets/js/15.543e8433.js"><link rel="prefetch" href="/java-learning/assets/js/16.2ce33a67.js"><link rel="prefetch" href="/java-learning/assets/js/17.1b3dedc1.js"><link rel="prefetch" href="/java-learning/assets/js/18.47d553e2.js"><link rel="prefetch" href="/java-learning/assets/js/19.8fea51c3.js"><link rel="prefetch" href="/java-learning/assets/js/20.edb7a984.js"><link rel="prefetch" href="/java-learning/assets/js/21.caeb796b.js"><link rel="prefetch" href="/java-learning/assets/js/22.5306d23b.js"><link rel="prefetch" href="/java-learning/assets/js/23.4fdb08ca.js"><link rel="prefetch" href="/java-learning/assets/js/24.acb59804.js"><link rel="prefetch" href="/java-learning/assets/js/25.b39354c7.js"><link rel="prefetch" href="/java-learning/assets/js/26.34744482.js"><link rel="prefetch" href="/java-learning/assets/js/28.ce175df3.js"><link rel="prefetch" href="/java-learning/assets/js/29.dddabea2.js"><link rel="prefetch" href="/java-learning/assets/js/3.03089721.js"><link rel="prefetch" href="/java-learning/assets/js/30.b34f1045.js"><link rel="prefetch" href="/java-learning/assets/js/31.20601aec.js"><link rel="prefetch" href="/java-learning/assets/js/32.1926f1e6.js"><link rel="prefetch" href="/java-learning/assets/js/33.f721c816.js"><link rel="prefetch" href="/java-learning/assets/js/34.97dae683.js"><link rel="prefetch" href="/java-learning/assets/js/35.8879bfab.js"><link rel="prefetch" href="/java-learning/assets/js/36.38b317bc.js"><link rel="prefetch" href="/java-learning/assets/js/37.fc694188.js"><link rel="prefetch" href="/java-learning/assets/js/38.a58c0bfc.js"><link rel="prefetch" href="/java-learning/assets/js/39.c660b3d6.js"><link rel="prefetch" href="/java-learning/assets/js/4.3ee03ea7.js"><link rel="prefetch" href="/java-learning/assets/js/40.1a5b1e06.js"><link rel="prefetch" href="/java-learning/assets/js/41.50ad159c.js"><link rel="prefetch" href="/java-learning/assets/js/42.90290904.js"><link rel="prefetch" href="/java-learning/assets/js/43.792193c1.js"><link rel="prefetch" href="/java-learning/assets/js/44.09f3c67e.js"><link rel="prefetch" href="/java-learning/assets/js/45.ef142fe2.js"><link rel="prefetch" href="/java-learning/assets/js/46.8eb12bba.js"><link rel="prefetch" href="/java-learning/assets/js/47.414ea3b9.js"><link rel="prefetch" href="/java-learning/assets/js/48.77647189.js"><link rel="prefetch" href="/java-learning/assets/js/49.d91c693d.js"><link rel="prefetch" href="/java-learning/assets/js/5.7883bb88.js"><link rel="prefetch" href="/java-learning/assets/js/50.7dcc0829.js"><link rel="prefetch" href="/java-learning/assets/js/51.425f52a3.js"><link rel="prefetch" href="/java-learning/assets/js/52.976027e7.js"><link rel="prefetch" href="/java-learning/assets/js/53.4cca20db.js"><link rel="prefetch" href="/java-learning/assets/js/54.ebee06ac.js"><link rel="prefetch" href="/java-learning/assets/js/55.f64789c2.js"><link rel="prefetch" href="/java-learning/assets/js/56.deadf2ad.js"><link rel="prefetch" href="/java-learning/assets/js/57.52a430c2.js"><link rel="prefetch" href="/java-learning/assets/js/58.cca49718.js"><link rel="prefetch" href="/java-learning/assets/js/59.20c3f232.js"><link rel="prefetch" href="/java-learning/assets/js/6.8382b96e.js"><link rel="prefetch" href="/java-learning/assets/js/60.f5b62f2b.js"><link rel="prefetch" href="/java-learning/assets/js/61.e7045df0.js"><link rel="prefetch" href="/java-learning/assets/js/62.afc8f203.js"><link rel="prefetch" href="/java-learning/assets/js/63.70e43f63.js"><link rel="prefetch" href="/java-learning/assets/js/64.11032ac2.js"><link rel="prefetch" href="/java-learning/assets/js/65.bd078e6e.js"><link rel="prefetch" href="/java-learning/assets/js/66.7fd924c8.js"><link rel="prefetch" href="/java-learning/assets/js/67.10634fbc.js"><link rel="prefetch" href="/java-learning/assets/js/68.47c73ce3.js"><link rel="prefetch" href="/java-learning/assets/js/69.346d76e6.js"><link rel="prefetch" href="/java-learning/assets/js/7.7c54cc3a.js"><link rel="prefetch" href="/java-learning/assets/js/70.4eaae357.js"><link rel="prefetch" href="/java-learning/assets/js/71.a9b3301d.js"><link rel="prefetch" href="/java-learning/assets/js/72.435b113d.js"><link rel="prefetch" href="/java-learning/assets/js/73.a452d682.js"><link rel="prefetch" href="/java-learning/assets/js/74.9783a1d9.js"><link rel="prefetch" href="/java-learning/assets/js/75.279971ae.js"><link rel="prefetch" href="/java-learning/assets/js/76.0532b064.js"><link rel="prefetch" href="/java-learning/assets/js/77.bc983f19.js"><link rel="prefetch" href="/java-learning/assets/js/78.697c5452.js"><link rel="prefetch" href="/java-learning/assets/js/79.cb38f138.js"><link rel="prefetch" href="/java-learning/assets/js/8.c8d0de62.js"><link rel="prefetch" href="/java-learning/assets/js/9.6f199a2d.js">
    <link rel="stylesheet" href="/java-learning/assets/css/0.styles.dcc29016.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/java-learning/" class="home-link router-link-active"><!----> <span class="site-name">Java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://kai-keng.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://kai-keng.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/spring-boot/" class="sidebar-heading clickable router-link-active open"><span>Spring Boot</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-learning/spring-boot/0-idea-configuration.html" class="sidebar-link">IDEA 相关配置介绍</a></li><li><a href="/java-learning/spring-boot/1-exception.html" class="sidebar-link">统一异常处理</a></li><li><a href="/java-learning/spring-boot/2-configuration.html" aria-current="page" class="active sidebar-link">配置文件实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#默认配置文件" class="sidebar-link">默认配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#默认配置文件类型" class="sidebar-link">默认配置文件类型</a></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#默认配置文件优先级" class="sidebar-link">默认配置文件优先级</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#自定义配置文件" class="sidebar-link">自定义配置文件</a></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#如何使用配置文件" class="sidebar-link">如何使用配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#使用默认配置文件" class="sidebar-link">使用默认配置文件</a></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#使用自定义配置文件" class="sidebar-link">使用自定义配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#不同环境如何切换不同配置文件" class="sidebar-link">不同环境如何切换不同配置文件</a></li><li class="sidebar-sub-header"><a href="/java-learning/spring-boot/2-configuration.html#使用-jar-包外的配置文件（实用）" class="sidebar-link">使用 jar 包外的配置文件（实用）</a></li></ul></li><li><a href="/java-learning/spring-boot/3-mybatis-druid.html" class="sidebar-link">Spring Boot 整合Mybatis与Druid</a></li><li><a href="/java-learning/spring-boot/4-spring-multi-datasource.html" class="sidebar-link">Mybatis多数据源配置</a></li><li><a href="/java-learning/spring-boot/5-operation-log-aop.html" class="sidebar-link">AOP实现超简易的操作日志记录</a></li><li><a href="/java-learning/spring-boot/6-redis-cache.html" class="sidebar-link">整合Redis缓存</a></li><li><a href="/java-learning/spring-boot/10-hibernate-validator.html" class="sidebar-link">Spring 参数校验实战</a></li><li><a href="/java-learning/spring-boot/11-mybatis-auto.html" class="sidebar-link">Mybatis自动化便捷操作</a></li><li><a href="/java-learning/spring-boot/12-common-result.html" class="sidebar-link">包装通用控制层返回结果</a></li><li><a href="/java-learning/spring-boot/13-knife4j.html" class="sidebar-link">Spring Boot整合Knife4j</a></li><li><a href="/java-learning/spring-boot/14-transactional.html" class="sidebar-link">事务管理</a></li><li><a href="/java-learning/spring-boot/15-mybatis-plus.html" class="sidebar-link">Mybatis-Plus</a></li><li><a href="/java-learning/spring-boot/16-dubbo.html" class="sidebar-link">简易整合Dubbo</a></li></ul></section></li><li><a href="/java-learning/spring-cloud/" class="sidebar-link">Spring Cloud</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/spring-security/" class="sidebar-heading clickable"><span>Spring Security</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/mysql/" class="sidebar-heading clickable"><span>MySQL</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/collection/" class="sidebar-heading clickable"><span>集合框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/jvm/" class="sidebar-heading clickable"><span>JVM</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/multi-thread/" class="sidebar-heading clickable"><span>多线程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/design-pattern/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/internet/" class="sidebar-link">网络</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/other/" class="sidebar-heading clickable"><span>其他</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/materials/" class="sidebar-link">相关资料</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="配置文件实战"><a href="#配置文件实战" class="header-anchor">#</a> 配置文件实战</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>在项目中，配置文件是很重要的一部分，主要关键的点在于以下两种配置：</p> <ol><li>基础配置（即不同环境下都相同的一些配置）</li> <li>环境配置（即不同环境，配置不同）</li></ol> <p>我们需要在项目中区分以上两种配置，并在不同的环境能够自动切换成不同的配置，便于开发。此文将说明Spring Boot中如何使用配置，且如何在不同环境下应用不同的配置。</p> <h2 id="默认配置文件"><a href="#默认配置文件" class="header-anchor">#</a> 默认配置文件</h2> <p>在Spring中，会自动读取约定好的位置上的指定文件名的文件作为配置文件，这些文件即是默认配置文件。</p> <h3 id="默认配置文件类型"><a href="#默认配置文件类型" class="header-anchor">#</a> 默认配置文件类型</h3> <p>默认的配置文件名称为application.yml或application.properties,这两种文件分别采用缩进式写法和全路径写法：</p> <blockquote><p>yaml文件缩进式写法</p></blockquote> <div class="language-YML extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment">#Mongo数据库配置</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">test1</span><span class="token punctuation">:</span>
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//test1<span class="token punctuation">:</span>1234@127.0.0.1<span class="token punctuation">:</span>27017/test1
        <span class="token key atrule">database</span><span class="token punctuation">:</span> test1
      <span class="token key atrule">test2</span><span class="token punctuation">:</span>
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//test2<span class="token punctuation">:</span>1234@127.0.0.1<span class="token punctuation">:</span>27017/test2
        <span class="token key atrule">database</span><span class="token punctuation">:</span> test2
</code></pre></div><blockquote><p>properties文件全路径写法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>spring.data.mongodb.test1.uri=mongodb://test1:1234@127.0.0.1:27017/test1
spring.data.mongodb.test1.database=test1
spring.data.mongodb.test2.uri=mongodb://test2:1234@127.0.0.1:27017/test2
spring.data.mongodb.test2.database=test2
</code></pre></div><p>两种写法都可以，选择一种即可，不过我认为yaml的写法会更加简洁，可读性也更好。</p> <h3 id="默认配置文件优先级"><a href="#默认配置文件优先级" class="header-anchor">#</a> 默认配置文件优先级</h3> <p>默认配置文件路径可以为以下4种：</p> <ol><li>当前项目目录下的一个/config子目录</li> <li>当前项目目录</li> <li>项目的resources即一个classpath下的/config包</li> <li>项目的resources即classpath根路径（root）</li></ol> <p>这些路径的配置文件优先级从上至下越来越低，如果出现重复的配置，则使用高优先级配置文件中的配置，且properties文件的配置优先级高于yml文件。</p> <p><img src="/java-learning/assets/img/configuration.8e18baef.jpg" alt="配置文件路径图"></p> <h2 id="自定义配置文件"><a href="#自定义配置文件" class="header-anchor">#</a> 自定义配置文件</h2> <p>Spring中当然也允许自定义配置文件，配置文件可以放置于src/main/resources路径下，一般来说我们都需要规范项目目录，所以我也没试放置于其他地方（比如根目录）下的情况。自定义配置文件其实和默认配置文件一致，只是文件名不同而已，不多赘述，具体情况可以实际测试使用。当然在使用方面，自定义配置和默认配置的区别在于使用的时候需要指定路径和文件名，在下一小节<a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">如何使用配置文件</a>介绍</p> <h2 id="如何使用配置文件"><a href="#如何使用配置文件" class="header-anchor">#</a> 如何使用配置文件</h2> <h3 id="使用默认配置文件"><a href="#使用默认配置文件" class="header-anchor">#</a> 使用默认配置文件</h3> <p>使用配置文件的方式有两种:</p> <blockquote><ol><li>直接在bean容器中使用<code>@Value</code>注解</li></ol></blockquote> <ol><li>定义<code>MongoProperties</code> Bean</li></ol> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MongoProperties</span> <span class="token punctuation">{</span>
	
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.data.mongodb.test1.uri}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uri<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.data.mongodb.test1.database}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> database<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>注入Bean，使用配置</li></ol> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MongoProperties</span> mongoProperties<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mongoProperties<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;——&quot;</span> <span class="token operator">+</span> mongoProperties<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><ol start="2"><li>在类上使用<code>@ConfigurationProperties</code>注解</li></ol></blockquote> <ol><li>定义完整的配置文件Bean类：</li></ol> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;spring.data.mongodb.test1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uri<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> database<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>除此之外还需在Spring Boot入口类加上注解@EnableConfigurationProperties({ConfigBean.class})来启用该配置：</li></ol> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ConfigBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
	
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>注入Bean，使用配置</li></ol> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ConfigBean</span> configBean<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> configBean<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;——&quot;</span> <span class="token operator">+</span> configBean<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用自定义配置文件"><a href="#使用自定义配置文件" class="header-anchor">#</a> 使用自定义配置文件</h3> <ol><li>在src/main/resources路径下新建test.properties：</li></ol> <div class="language-YML extra-class"><pre class="language-yml"><code><span class="token key atrule">test</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> KangKang
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">25</span>
</code></pre></div><ol start="2"><li>定义Bean：</li></ol> <div class="language-JAVA extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:test.properties&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestConfigBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token comment">// get,set略</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注解<code>@PropertySource(&quot;classpath:test.properties&quot;)</code>指明了使用哪个配置文件。要使用该配置Bean，同样也需要在入口类里使用注解<code>@EnableConfigurationProperties({TestConfigBean.class})</code>来启用该配置。</p> <h2 id="不同环境如何切换不同配置文件"><a href="#不同环境如何切换不同配置文件" class="header-anchor">#</a> 不同环境如何切换不同配置文件</h2> <p>Spring中默认支持不同环境使用不同配置文件，我们可以以<em>application-{profile}.yml</em>的格式命名，建立多个profile配置文件，比如application-dev.yml、application-prod.yml，分别对应测试环境和生产环境，然后我们可以在application.yml文件中定义<code>spring.profiles.active</code>配置，这个变量的值等于dev即表示加载application-dev.yml配置文件，通过改变该变配置值来选择不同的环境。</p> <blockquote><p>实际运用中，我们不可能通过更改application.yml文件中的<code>spring.profiles.active</code>配置来更换环境，有另一种做法则是在用java命令运行的时候指定<code>spring.profiles.active</code>变量的值来选择配置：<em>java -jar xxx.jar --spring.profiles.active={profile}</em></p></blockquote> <h2 id="使用-jar-包外的配置文件（实用）"><a href="#使用-jar-包外的配置文件（实用）" class="header-anchor">#</a> 使用 jar 包外的配置文件（实用）</h2> <p>在生产中，我们有时候需要外挂配置文件，便于修改一些配置而不需要重新去改代码并打包，那么如何让程序读取到外部的配置文件呢？</p> <p>我使用的方法是在使用 java -jar xxx.jar 启动的时候添加额外的参数 <strong>-Dspring.config.location=/usr/src/app/config/application.yml</strong> 来指定外挂配置的位置，并优先使用这个外挂配置，详见<a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料3</a>。</p> <h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <p>实际运用中，我们可以使用application.yml文件来放置<em>基础配置</em>，然后创建不同的profile配置文件来放置不同环境的配置，启动的时候修改<code>spring.profiles.active</code>变量来达到不同环境不同配置文件的目的。实际生产中我并没有使用这种方式，因为生产使用的是微服务的方式，使用Rancher平台维护服务，我们默认在<em>src/main/resources</em>路径下放置本地测试配置文件，在部署的时候通过<em>configMap</em>的方式将配置文件在部署的时候写入<em>src/main/resources/config</em>路径下，使用配置优先级来让程序优先使用config路径下的配置文件。同时不同环境有不同的Rancher平台，可以在不同平台分别写入不同的配置，所以情况不同可以依据情况来灵活改变。</p> <h1 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h1> <ol><li><a href="https://www.jianshu.com/p/3c615bd42799" target="_blank" rel="noopener noreferrer">SpringBoot配置文件——加载顺序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mrbird.cc/Spring-Boot%20basic%20config.html" target="_blank" rel="noopener noreferrer">Spring Boot一些基础配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/Dh_Chao/article/details/78663365?utm_medium=distribute.pc_relevant.none-task-blog-title-7&amp;spm=1001.2101.3001.4242" target="_blank" rel="noopener noreferrer">SpringBoot 项目打成 jar 包后关于配置文件的外部化配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java-learning/spring-boot/1-exception.html" class="prev">
        统一异常处理
      </a></span> <span class="next"><a href="/java-learning/spring-boot/3-mybatis-druid.html">
        Spring Boot 整合Mybatis与Druid
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/java-learning/assets/js/app.ac2a67bc.js" defer></script><script src="/java-learning/assets/js/2.008936f0.js" defer></script><script src="/java-learning/assets/js/27.9d817416.js" defer></script>
  </body>
</html>
