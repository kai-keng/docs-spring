<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>索引 | Java</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Just record my learning process">
    <link rel="preload" href="/java-learning/assets/css/0.styles.dcc29016.css" as="style"><link rel="preload" href="/java-learning/assets/js/app.cce1b4e5.js" as="script"><link rel="preload" href="/java-learning/assets/js/2.073b9d23.js" as="script"><link rel="preload" href="/java-learning/assets/js/12.e9b9ebbb.js" as="script"><link rel="prefetch" href="/java-learning/assets/js/10.dad40421.js"><link rel="prefetch" href="/java-learning/assets/js/11.ce128f48.js"><link rel="prefetch" href="/java-learning/assets/js/13.cd90e4cd.js"><link rel="prefetch" href="/java-learning/assets/js/14.2eeb1f09.js"><link rel="prefetch" href="/java-learning/assets/js/15.a8802938.js"><link rel="prefetch" href="/java-learning/assets/js/16.1629ef5d.js"><link rel="prefetch" href="/java-learning/assets/js/17.925059d9.js"><link rel="prefetch" href="/java-learning/assets/js/18.41bf69ff.js"><link rel="prefetch" href="/java-learning/assets/js/19.1fa04d72.js"><link rel="prefetch" href="/java-learning/assets/js/20.603c38b3.js"><link rel="prefetch" href="/java-learning/assets/js/21.e413be99.js"><link rel="prefetch" href="/java-learning/assets/js/22.da4de311.js"><link rel="prefetch" href="/java-learning/assets/js/23.72b01e86.js"><link rel="prefetch" href="/java-learning/assets/js/24.9af2598a.js"><link rel="prefetch" href="/java-learning/assets/js/25.ddd92ca4.js"><link rel="prefetch" href="/java-learning/assets/js/26.30915e39.js"><link rel="prefetch" href="/java-learning/assets/js/27.1c256433.js"><link rel="prefetch" href="/java-learning/assets/js/28.450f5c1a.js"><link rel="prefetch" href="/java-learning/assets/js/29.a046e6c3.js"><link rel="prefetch" href="/java-learning/assets/js/3.9a561856.js"><link rel="prefetch" href="/java-learning/assets/js/30.e6ae58bf.js"><link rel="prefetch" href="/java-learning/assets/js/31.0c707e95.js"><link rel="prefetch" href="/java-learning/assets/js/32.2aaaaffa.js"><link rel="prefetch" href="/java-learning/assets/js/33.035dfa95.js"><link rel="prefetch" href="/java-learning/assets/js/34.9c460ede.js"><link rel="prefetch" href="/java-learning/assets/js/35.5288aa94.js"><link rel="prefetch" href="/java-learning/assets/js/36.60128c6c.js"><link rel="prefetch" href="/java-learning/assets/js/37.eef08c7a.js"><link rel="prefetch" href="/java-learning/assets/js/38.22961b1e.js"><link rel="prefetch" href="/java-learning/assets/js/39.ec3479b5.js"><link rel="prefetch" href="/java-learning/assets/js/4.121edae5.js"><link rel="prefetch" href="/java-learning/assets/js/40.2d9de629.js"><link rel="prefetch" href="/java-learning/assets/js/41.e7ec9137.js"><link rel="prefetch" href="/java-learning/assets/js/42.6852d284.js"><link rel="prefetch" href="/java-learning/assets/js/43.43de6cec.js"><link rel="prefetch" href="/java-learning/assets/js/44.1ebb78f6.js"><link rel="prefetch" href="/java-learning/assets/js/45.97fbdcac.js"><link rel="prefetch" href="/java-learning/assets/js/46.b6bca0f5.js"><link rel="prefetch" href="/java-learning/assets/js/47.0e834db6.js"><link rel="prefetch" href="/java-learning/assets/js/48.a013613d.js"><link rel="prefetch" href="/java-learning/assets/js/49.2f32e19b.js"><link rel="prefetch" href="/java-learning/assets/js/5.9c9b10b1.js"><link rel="prefetch" href="/java-learning/assets/js/50.a5c72d35.js"><link rel="prefetch" href="/java-learning/assets/js/51.4fb9ca64.js"><link rel="prefetch" href="/java-learning/assets/js/52.95a10627.js"><link rel="prefetch" href="/java-learning/assets/js/53.0d3efd34.js"><link rel="prefetch" href="/java-learning/assets/js/54.159b44a9.js"><link rel="prefetch" href="/java-learning/assets/js/55.7e9c2224.js"><link rel="prefetch" href="/java-learning/assets/js/56.66727fd2.js"><link rel="prefetch" href="/java-learning/assets/js/57.3df933e0.js"><link rel="prefetch" href="/java-learning/assets/js/58.46f7ca5e.js"><link rel="prefetch" href="/java-learning/assets/js/59.905d8f03.js"><link rel="prefetch" href="/java-learning/assets/js/6.6f342fa7.js"><link rel="prefetch" href="/java-learning/assets/js/60.e0deab68.js"><link rel="prefetch" href="/java-learning/assets/js/61.e51cee88.js"><link rel="prefetch" href="/java-learning/assets/js/62.be3edbae.js"><link rel="prefetch" href="/java-learning/assets/js/63.6ed84f94.js"><link rel="prefetch" href="/java-learning/assets/js/64.fbd48c80.js"><link rel="prefetch" href="/java-learning/assets/js/65.f26d0572.js"><link rel="prefetch" href="/java-learning/assets/js/66.fb6c4361.js"><link rel="prefetch" href="/java-learning/assets/js/67.823abbfa.js"><link rel="prefetch" href="/java-learning/assets/js/68.0672442c.js"><link rel="prefetch" href="/java-learning/assets/js/69.ca59db09.js"><link rel="prefetch" href="/java-learning/assets/js/7.2a3e44a6.js"><link rel="prefetch" href="/java-learning/assets/js/70.5dc66259.js"><link rel="prefetch" href="/java-learning/assets/js/71.7b26e040.js"><link rel="prefetch" href="/java-learning/assets/js/72.6b41145a.js"><link rel="prefetch" href="/java-learning/assets/js/8.f268628b.js"><link rel="prefetch" href="/java-learning/assets/js/9.76ea7ae1.js">
    <link rel="stylesheet" href="/java-learning/assets/css/0.styles.dcc29016.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/java-learning/" class="home-link router-link-active"><!----> <span class="site-name">Java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://kai-keng.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://kai-keng.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/spring-boot/" class="sidebar-heading clickable"><span>Spring Boot</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/spring-cloud/" class="sidebar-link">Spring Cloud</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/mysql/" class="sidebar-heading clickable router-link-active open"><span>MySQL</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-learning/mysql/mysql-index.html" aria-current="page" class="active sidebar-link">索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#什么是索引？" class="sidebar-link">什么是索引？</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引有哪些优缺点？" class="sidebar-link">索引有哪些优缺点？</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引使用场景（重点）" class="sidebar-link">索引使用场景（重点）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#where" class="sidebar-link">where</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#order-by" class="sidebar-link">order by</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#join" class="sidebar-link">join</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引覆盖" class="sidebar-link">索引覆盖</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引有哪几种类型？" class="sidebar-link">索引有哪几种类型？</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引的基本原理" class="sidebar-link">索引的基本原理</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引设计的原则？" class="sidebar-link">索引设计的原则？</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#创建索引的原则（重中之重）" class="sidebar-link">创建索引的原则（重中之重）</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#索引的创建与删除操作" class="sidebar-link">索引的创建与删除操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#创建索引" class="sidebar-link">创建索引</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#删除索引" class="sidebar-link">删除索引</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#前缀索引" class="sidebar-link">前缀索引</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#什么是最左前缀原则？什么是最左匹配原则" class="sidebar-link">什么是最左前缀原则？什么是最左匹配原则</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#什么是b树-b-tree-与b-树-b-tree" class="sidebar-link">什么是B树(B-tree)与B+树(B+tree)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#b树需满足的条件" class="sidebar-link">B树需满足的条件</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#b树的插入与删除" class="sidebar-link">B树的插入与删除</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#b树的缺点" class="sidebar-link">B树的缺点</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#什么是b-树" class="sidebar-link">什么是B+树</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#b-树需满足的条件" class="sidebar-link">B+树需满足的条件</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#b-树与b树的不同" class="sidebar-link">B+树与B树的不同</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#b-树的优点" class="sidebar-link">B+树的优点</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#什么是聚簇索引与非聚簇索引" class="sidebar-link">什么是聚簇索引与非聚簇索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#聚簇索引" class="sidebar-link">聚簇索引</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#辅助索引（非聚簇索引）" class="sidebar-link">辅助索引（非聚簇索引）</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#联合索引是什么？为什么需要注意联合索引中的顺序？" class="sidebar-link">联合索引是什么？为什么需要注意联合索引中的顺序？</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#什么是hash索引" class="sidebar-link">什么是Hash索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#优点" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#缺点" class="sidebar-link">缺点</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-learning/mysql/mysql-index.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/java-learning/mysql/datatype.html" class="sidebar-link">数据类型</a></li><li><a href="/java-learning/mysql/transaction.html" class="sidebar-link">事务（Transaction）</a></li><li><a href="/java-learning/mysql/explain.html" class="sidebar-link">Explain（执行计划）字段解析</a></li><li><a href="/java-learning/mysql/sql-optimization.html" class="sidebar-link">SQL 优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/collection/" class="sidebar-heading clickable"><span>集合框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/jvm/" class="sidebar-heading clickable"><span>JVM</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/multi-thread/" class="sidebar-heading clickable"><span>多线程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/design-pattern/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/internet/" class="sidebar-link">网络</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/other/" class="sidebar-heading clickable"><span>其他</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/materials/" class="sidebar-link">相关资料</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h1> <h2 id="什么是索引？"><a href="#什么是索引？" class="header-anchor">#</a> 什么是索引？</h2> <p>索引是一种特殊的文件(InnoDB数据表上的索引是表空间的一个组成部分)，它们包含着对数据表里所有记录的引用指针。</p> <p>索引是一种数据结构。数据库索引，是数据库管理系统中一个排序的数据结构，以协助快速查询、更新数据库表中数据。索引的实现通常使用B树及其变种B+树。</p> <p>更通俗的说，索引就相当于目录。为了方便查找书中的内容，通过对内容建立索引形成目录。索引是一个文件，它是要占据物理空间的</p> <h2 id="索引有哪些优缺点？"><a href="#索引有哪些优缺点？" class="header-anchor">#</a> 索引有哪些优缺点？</h2> <p>索引的优点</p> <ul><li>可以大大加快数据的检索速度，这也是创建索引的最主要的原因。</li> <li>通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。</li></ul> <p>索引的缺点</p> <ul><li>时间方面：创建索引和维护索引要耗费时间，具体地，当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，会降低增/改/删的执行效率；</li> <li>空间方面：索引需要占物理空间。</li></ul> <h2 id="索引使用场景（重点）"><a href="#索引使用场景（重点）" class="header-anchor">#</a> 索引使用场景（重点）</h2> <h3 id="where"><a href="#where" class="header-anchor">#</a> where</h3> <p><img src="/java-learning/assets/img/index-1.e6f1d3a8.jpg" alt="主键索引"></p> <p>上图中，根据<code>id</code>查询记录，因为<code>id</code>字段仅建立了主键索引，因此此SQL执行可选的索引只有主键索引，如果有多个，最终会选一个较优的作为检索的依据。</p> <h3 id="order-by"><a href="#order-by" class="header-anchor">#</a> order by</h3> <p>当我们使用<code>order by</code>将查询结果按照某个字段排序时，如果该字段没有建立索引，那么执行计划会将查询出的所有数据使用外部排序（将数据从硬盘分批读取到内存使用内部排序，最后合并排序结果），这个操作是很影响性能的，因为需要将查询涉及到的所有数据从磁盘中读到内存（如果单条数据过大或者数据量过多都会降低效率），更无论读到内存之后的排序了。</p> <p>但是如果我们对该字段建立索引<code>alter table 表名 add index(字段名)</code>，那么由于索引本身是有序的，因此直接按照索引的顺序和映射关系逐条取出数据即可。而且如果分页的，那么只用取出索引表某个范围内的索引对应的数据，而不用像上述那取出所有数据进行排序再返回某个范围内的数据。（从磁盘取数据是最影响性能的）</p> <h3 id="join"><a href="#join" class="header-anchor">#</a> join</h3> <p>对<code>join</code>语句匹配关系<code>on</code>涉及的字段建立索引能够提高效率</p> <h3 id="索引覆盖"><a href="#索引覆盖" class="header-anchor">#</a> 索引覆盖</h3> <p>如果要查询的字段都建立过索引，那么引擎会直接在索引表中查询而不会访问原始数据（否则只要有一个字段没有建立索引就会做全表扫描），这叫索引覆盖。因此我们需要尽可能的在select后只写必要的查询字段，以增加索引覆盖的几率。</p> <p>这里值得注意的是不要想着为每个字段建立索引，因为优先使用索引的优势就在于其体积小。</p> <h2 id="索引有哪几种类型？"><a href="#索引有哪几种类型？" class="header-anchor">#</a> 索引有哪几种类型？</h2> <p><strong>主键索引</strong>: 数据列不允许重复，不允许为NULL，一个表只能有一个主键。</p> <p><strong>唯一索引</strong>: 数据列不允许重复，允许为NULL值，一个表允许多个列创建唯一索引。</p> <ul><li><p>可以通过 <code>ALTER TABLE table_name ADD UNIQUE (column);</code> 创建唯一索引</p></li> <li><p>可以通过 <code>ALTER TABLE table_name ADD UNIQUE (column1,column2);</code> 创建唯一组合索引</p></li></ul> <p><strong>普通索引</strong>: 基本的索引类型，没有唯一性的限制，允许为NULL值。</p> <ul><li><p>可以通过<code>ALTER TABLE table_name ADD INDEX index_name (column);</code>创建普通索引</p></li> <li><p>可以通过<code>ALTER TABLE table_name ADD INDEX index_name(column1, column2, column3);</code>创建组合索引</p></li></ul> <p><strong>全文索引</strong>： 用关键字的匹配来进行查询过滤，基于相似度的查询，是目前搜索引擎使用的一种关键技术。</p> <ul><li>可以通过<code>ALTER TABLE table_name ADD FULLTEXT (column);</code>创建全文索引</li></ul> <h2 id="索引的基本原理"><a href="#索引的基本原理" class="header-anchor">#</a> 索引的基本原理</h2> <p>索引用来快速地寻找那些具有特定值的记录。如果没有索引，一般来说执行查询时遍历整张表。</p> <p>索引的原理很简单，就是把无序的数据变成有序的查询：</p> <ol><li>把创建了索引的列的内容进行排序</li> <li>对排序结果生成倒排表</li> <li>在倒排表内容上拼上数据地址链</li> <li>在查询的时候，先拿到倒排表内容，再取出数据地址链，从而拿到具体数据</li></ol> <h2 id="索引设计的原则？"><a href="#索引设计的原则？" class="header-anchor">#</a> 索引设计的原则？</h2> <ul><li>创建在适合的场景。</li> <li>区分度较小的列无需索引。</li> <li>使用短索引，长字符需指定一个前缀长度，这样能够节省大量索引空间。</li> <li>不要过度索引。索引需要额外的磁盘空间，并降低写操作的性能。在修改表内容的时候，索引会进行更新甚至重构，索引列越多，这个时间就会越长。所以只保持需要的索引有利于查询即可。</li></ul> <h2 id="创建索引的原则（重中之重）"><a href="#创建索引的原则（重中之重）" class="header-anchor">#</a> 创建索引的原则（重中之重）</h2> <ul><li>最左前缀匹配原则，组合索引非常重要的原则，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</li> <li>较频繁作为查询条件的字段才去创建索引。</li> <li>更新频繁字段不适合创建索引。</li> <li>若是不能有效区分数据的列不适合做索引列(如性别，男女未知，最多也就三种，区分度实在太低)。</li> <li>尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。</li> <li>定义有外键的数据列一定要建立索引。</li> <li>对于定义为text、image和bit的数据类型的列不要建立索引。</li> <li>应该指定索引列为NOT NULL，除非你想存储NULL。在mysql中，含有空值的列很难进行查询优化，因为它们使得索引、索引的统计信息以及比较运算更加复杂。你应该用0、一个特殊的值或者一个空串代替空值。</li> <li>索引字段越小越好，数据库的数据存储以页为单位一页存储的数据越多一次IO操作获取的数据越大效率越高。</li></ul> <h2 id="索引的创建与删除操作"><a href="#索引的创建与删除操作" class="header-anchor">#</a> 索引的创建与删除操作</h2> <h3 id="创建索引"><a href="#创建索引" class="header-anchor">#</a> 创建索引</h3> <ol><li>在执行CREATE TABLE时创建索引</li></ol> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_index2 <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">auto_increment</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	first_name <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	last_name <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	id_card <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	information <span class="token keyword">text</span><span class="token punctuation">,</span>
	<span class="token keyword">KEY</span> name <span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> last_name<span class="token punctuation">)</span><span class="token punctuation">,</span>
	FULLTEXT <span class="token keyword">KEY</span> <span class="token punctuation">(</span>information<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id_card<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>使用ALTER TABLE命令去增加索引</li></ol> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>ALTER TABLE用来创建普通索引、UNIQUE索引或PRIMARY KEY索引。其中table_name是要增加索引的表名，column_list指出对哪些列进行索引，多列时各列之间用逗号分隔。索引名index_name可自己命名，缺省时，MySQL将根据第一个索引列赋一个名称。另外，ALTER TABLE允许在单个语句中更改多个表，因此可以在同时创建多个索引。</p></blockquote> <ol start="3"><li>使用CREATE INDEX命令创建</li></ol> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>CREATE INDEX可对表增加普通索引或UNIQUE索引，但是不能创建PRIMARY KEY索引。</p></blockquote> <h3 id="删除索引"><a href="#删除索引" class="header-anchor">#</a> 删除索引</h3> <p>根据索引名删除普通索引、唯一索引、全文索引：<code>alter table 表名 drop KEY 索引名</code>。</p> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> user_index <span class="token keyword">drop</span> <span class="token keyword">KEY</span> name<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> user_index <span class="token keyword">drop</span> <span class="token keyword">KEY</span> id_card<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> user_index <span class="token keyword">drop</span> <span class="token keyword">KEY</span> information<span class="token punctuation">;</span>
</code></pre></div><p>删除主键索引：<code>alter table 表名 drop primary key</code>（因为主键只有一个）。</p> <blockquote><p>这里值得注意的是，如果主键自增长，那么不能直接执行此操作,自增长依赖于主键索引,需要取消自增长再行删除。</p></blockquote> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> user_index
<span class="token comment">-- 重新定义字段</span>
<span class="token keyword">MODIFY</span> id <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">drop</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>
</code></pre></div><h2 id="前缀索引"><a href="#前缀索引" class="header-anchor">#</a> 前缀索引</h2> <p>语法：<code>index(field(10))</code>，使用字段值的前10个字符建立索引，默认是使用字段的全部内容建立索引。</p> <p>前提：前缀的标识度高。比如密码就适合建立前缀索引，因为密码几乎各不相同。</p> <p>实操的难度在于前缀截取的长度。</p> <p>我们可以利用<code>select count(*)/count(distinct left(password,prefixLen)) from table;</code>，通过从调整prefixLen的值（从1自增）查看不同前缀长度的一个平均匹配度，接近1时就可以了（表示一个密码的前prefixLen个字符几乎能确定唯一一条记录）</p> <h2 id="什么是最左前缀原则？什么是最左匹配原则"><a href="#什么是最左前缀原则？什么是最左匹配原则" class="header-anchor">#</a> 什么是最左前缀原则？什么是最左匹配原则</h2> <ul><li>顾名思义，就是最左优先，在创建多列索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。</li> <li>最左前缀匹配原则，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</li> <li>=和in可以乱序，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式</li></ul> <h2 id="什么是b树-b-tree-与b-树-b-tree"><a href="#什么是b树-b-tree-与b-树-b-tree" class="header-anchor">#</a> 什么是B树(B-tree)与B+树(B+tree)</h2> <p>B树是一种多路平衡查找树，具有很高的查询效率。B-树与B树是同一种树，有时会被人误认为是B树的变种。</p> <h3 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h3> <ul><li>阶：B-树中所有结点中孩子结点个数的最大值成为B-树的阶，通常用m表示，从查找效率考虑，一般要求m&gt;=3。</li> <li>关键字：节点上记录的关键值。</li> <li>根节点：树的根节点，第一层的节点</li> <li>叶子节点：最底层的节点</li> <li>卫星数据：指的是节点上的索引元素指向的数据记录，比如数据库的某一行。</li></ul> <h3 id="b树需满足的条件"><a href="#b树需满足的条件" class="header-anchor">#</a> B树需满足的条件</h3> <ul><li>每个结点最多有m个分支，如果是根结点则至少要有两个分支，除了根节点和叶子节点外，其它每个节点至少有Ceil(m/2)个孩子，cell向上取整。</li> <li>所有叶子节点都在同一层，且不包含其它关键字信息</li> <li>如果一个结点有n个关键字，那么该结点有n+1个分支。</li> <li>关键字的个数n满足：ceil(m/2)-1 &lt;= n &lt;= m-1。（可由关键字与分支关系、分支最多最少限制推导）</li> <li>每个节点由关键字和指向子树根节点的指针构成，ki(i=1,…n)为关键字，且关键字升序排序，Pi(i=1,…n)为指向子树根节点的指针。</li> <li>P(i-1)指向的子树的所有节点的关键字均小于ki，但都大于k(i-1)。</li></ul> <blockquote><p>B树结构如下图，为了描述B-Tree，首先定义一条记录为一个二元组[key, data] ，key为记录的键值，对应表中的主键值，data为一行记录中除主键外的数据。对于不同的记录，key值互不相同。</p></blockquote> <p><img src="/java-learning/assets/img/index-B-tree-1.045331bc.jpg" alt="B-tree"></p> <p>模拟查找关键字29的过程：</p> <ol><li><p>根据根节点找到磁盘块1，读入内存。【磁盘I/O操作第1次】</p></li> <li><p>比较关键字29在区间（17,35），找到磁盘块1的指针P2</p></li> <li><p>根据P2指针找到磁盘块3，读入内存。【磁盘I/O操作第2次】</p></li> <li><p>比较关键字29在区间（26,30），找到磁盘块3的指针P2</p></li> <li><p>根据P2指针找到磁盘块8，读入内存。【磁盘I/O操作第3次】</p></li> <li><p>在磁盘块8中的关键字列表中找到关键字29</p></li></ol> <h3 id="b树的插入与删除"><a href="#b树的插入与删除" class="header-anchor">#</a> B树的插入与删除</h3> <p>为了保证满足B树的构成条件，在B树的插入/删除的时候需要进行一些拆分/合并的步骤，总结下就是：</p> <ul><li>B树的插入首要可以维持最大关键词个数，若插入的数据超出最大关键词个数则进行拆分，拆分从关键词中间拆分，以中间节点为根节点。</li> <li>B树的删除同样需要满足最小关键词个数要求，若不足则需进行合并且合并后需满足最小分支要求。</li></ul> <p>具体的插入删除流程参照<a href="https://www.jianshu.com/p/7dedb7ebe033" target="_blank" rel="noopener noreferrer">B-树（B树）详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="b树的缺点"><a href="#b树的缺点" class="header-anchor">#</a> B树的缺点</h3> <p>虽然B树的查询效率已经很高，但是依旧有一些缺点：</p> <ul><li>B树的每个节点都保存了索引以及卫星数据，这样导致每个节点存储的数据比较多，每一层能容纳的索引减少，会加深树的深度，导致查询效率降低。</li> <li>同时由于上一点问题存在，导致有可能在根节点就匹配上了，获取到卫星数据，也有可能在叶子节点才匹配上，获取到卫星数据。导致查询性能不稳定。</li> <li>面对范围查询时，B树查询比较复杂，需要使用中序遍历来遍历树，需要多次io操作。</li></ul> <h3 id="什么是b-树"><a href="#什么是b-树" class="header-anchor">#</a> 什么是B+树</h3> <p>B+树是B树的变种，解决的B树的缺陷，查询性能更优。</p> <h3 id="b-树需满足的条件"><a href="#b-树需满足的条件" class="header-anchor">#</a> B+树需满足的条件</h3> <ul><li>每个结点至多有m个分支</li> <li>除根结点外,每个结点至少有[m/2]个子女，根结点至少有两个子女</li> <li>有k个子女的结点必有k个关键字</li> <li>父节点的关键字在子节点中都存在，要么是最小值，要么是最大值，如果节点中关键字是升序的方式，父节点的关键字是子节点的最小值</li> <li>除叶子节点之外，其他节点不保存卫星数据，只保存关键字和指针</li> <li>叶子节点包含了所有数据的关键字以及data，叶子节点之间用链表连接起来，可以非常方便的支持范围查找</li></ul> <p><img src="/java-learning/assets/img/index-B-tree-2.78576cc8.jpg" alt="B+-tree"></p> <h3 id="b-树与b树的不同"><a href="#b-树与b树的不同" class="header-anchor">#</a> B+树与B树的不同</h3> <ul><li>B树比B+树节点多了一个指向分支的指针</li> <li>B树所有的节点都会保存卫星数据，但是B+树只有叶子节点才会保存数据</li> <li>B+树的叶子节点直接按照顺序用链表互相连接，而B树的叶子节点没有</li></ul> <h3 id="b-树的优点"><a href="#b-树的优点" class="header-anchor">#</a> B+树的优点</h3> <p>综上不同点，B+树的优点在于：</p> <ul><li>只有叶子节点保存卫星数据，减小上层节点大小，让上层可以保存更多数据，降低树的深度，减少io次数</li> <li>只有叶子节点保留数据，查询更加稳定</li> <li>叶子节点使用链表连接，范围查询优于B树</li> <li>增删文件（节点）时，效率更高。因为B+树的叶子节点包含所有关键字，并以有序的链表结构存储，这样可很好提高增删效率。</li></ul> <h2 id="什么是聚簇索引与非聚簇索引"><a href="#什么是聚簇索引与非聚簇索引" class="header-anchor">#</a> 什么是聚簇索引与非聚簇索引</h2> <blockquote><p>以下描述皆基于Innodb</p></blockquote> <p>聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。具体细节依赖于其实现方式。B+树索引可以分为聚簇索引（也称聚集索引，clustered index）和辅助索引（有时也称非聚簇索引或二级索引，secondary index，non-clustered index）。</p> <h3 id="聚簇索引"><a href="#聚簇索引" class="header-anchor">#</a> 聚簇索引</h3> <p>聚簇索引即是依据主键来建立一颗B+树（若没有主键则会自动选择一列非空唯一索引或建立隐式主键），其叶子节点直接保存主键指向的行数据，因此特性所以也将聚簇索引的叶子节点称为数据页。Innodb中表数据文件本身就是按B+树组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录，这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引。</p> <p><strong>优点：</strong></p> <ul><li>数据访问更快，因为聚簇索引将索引和数据保存在同一个B+树中，因此从聚簇索引中获取数据比非聚簇索引更快。</li> <li>聚簇索引对于主键的排序查找和范围查找速度非常快。</li></ul> <p><strong>缺点：</strong></p> <ul><li>插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式，否则将会出现页分裂，严重影响性能。因此我们一般都会定义一个自增的ID列为主键。</li> <li>更新主键的代价很高，因为将会导致被更新的行移动。因此，对于InnoDB表，我们一般定义主键为不可更新。</li></ul> <h3 id="辅助索引（非聚簇索引）"><a href="#辅助索引（非聚簇索引）" class="header-anchor">#</a> 辅助索引（非聚簇索引）</h3> <p>辅助索引是依据你指定的键来建立一颗B+树，但是其叶子节点不会保存完整的行数据，其保存的是主键值。我们通过辅助索引查询的时候需要先查询辅助索引，获取到主键值，然后再通过主键值查询聚簇索引（回表查询），获取到真正的数据，故辅助索引也称为二级索引，需要查询两次。辅助索引的存在不影响数据在聚簇索引中的组织，所以一张表可以有多个辅助索引。</p> <p>但是并不是所有的辅助索引查询都需要回表查询，当发生了索引覆盖，即你查询的字段只是索引字段本身的时候，B+树中已经携带了字段信息，便不再需要去回表查询了。</p> <h2 id="联合索引是什么？为什么需要注意联合索引中的顺序？"><a href="#联合索引是什么？为什么需要注意联合索引中的顺序？" class="header-anchor">#</a> 联合索引是什么？为什么需要注意联合索引中的顺序？</h2> <p>MySQL可以使用多个字段同时建立一个索引，叫做联合索引。在联合索引中，如果想要命中索引，需要按照建立索引时的字段顺序挨个使用，否则无法命中索引。</p> <p>具体原因为:</p> <p>MySQL使用索引时需要索引有序，假设现在建立了&quot;name，age，school&quot;的联合索引，那么索引的排序为: 先按照name排序，如果name相同，则按照age排序，如果age的值也相等，则按照school进行排序。</p> <p>当进行查询时，此时索引仅仅按照name严格有序，因此必须首先使用name字段进行等值查询，之后对于匹配到的列而言，其按照age字段严格有序，此时可以使用age字段用做索引查找，以此类推。如果你先查询age的话，此时索引并没有按照age排序，所以无法匹配上。因此在建立联合索引的时候应该注意索引列的顺序，一般情况下，将查询需求频繁或者字段选择性高的列放在前面。此外可以根据特例的查询或者表结构进行单独的调整。</p> <h2 id="什么是hash索引"><a href="#什么是hash索引" class="header-anchor">#</a> 什么是Hash索引</h2> <p>hash索引基于哈希表实现，进行查找时，调用一次hash函数就可以获取到相应的键值，之后进行回表查询获得实际数据。因为在hash索引中经过hash函数建立索引之后，索引的顺序与原顺序无法保持一致，且键值不同的话，哈希函数处理完以后的值完全不同，所以只支持精确查找。</p> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h3> <ul><li>一般情况下hash索引进行等值查询更快</li></ul> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <ul><li>hash索引不支持使用索引进行排序，因为在hash索引中经过hash函数建立索引之后，索引的顺序与原顺序无法保持一致。</li> <li>hash索引不支持模糊查询以及多列索引的最左前缀匹配。原理也是因为hash函数的不可预测。AAAA和AAAAB的索引没有相关性。</li> <li>hash索引任何时候都避免不了回表查询数据，而B+树在符合某些条件(聚簇索引，覆盖索引等)的时候可以只通过索引完成查询。</li> <li>hash索引虽然在等值查询上较快，但是不稳定。性能不可预测，当某个键值存在大量重复的时候，发生hash碰撞，此时效率可能极差。</li></ul> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ol><li><a href="https://blog.csdn.net/ThinkWon/article/details/104778621" target="_blank" rel="noopener noreferrer">MySQL数据库面试题（2020最新版）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933422&amp;idx=1&amp;sn=f28a92c195d914d636117c2316524c5e&amp;chksm=88621c10bf159506af8a3c6b947e32b11414ff72ed3ad19a9fa0b0cec0be6c3ae3931117b3d2&amp;token=498198732&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">玩转Mysql系列 - 第22篇：mysql索引原理详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/7dedb7ebe033" target="_blank" rel="noopener noreferrer">B-树（B树）详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/qq_26222859/article/details/80631121" target="_blank" rel="noopener noreferrer">b+树图文详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/jiawen010/p/11805241.html" target="_blank" rel="noopener noreferrer">聚簇索引和非聚簇索引(通俗易懂 言简意赅)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java-learning/spring-cloud/" class="prev">
        Spring Cloud
      </a></span> <span class="next"><a href="/java-learning/mysql/datatype.html">
        数据类型
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/java-learning/assets/js/app.cce1b4e5.js" defer></script><script src="/java-learning/assets/js/2.073b9d23.js" defer></script><script src="/java-learning/assets/js/12.e9b9ebbb.js" defer></script>
  </body>
</html>
