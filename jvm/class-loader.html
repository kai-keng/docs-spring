<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>类加载器 | Java</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Just record my learning process">
    <link rel="preload" href="/java-learning/assets/css/0.styles.dcc29016.css" as="style"><link rel="preload" href="/java-learning/assets/js/app.19408cb2.js" as="script"><link rel="preload" href="/java-learning/assets/js/2.5d689308.js" as="script"><link rel="preload" href="/java-learning/assets/js/30.de82ee17.js" as="script"><link rel="prefetch" href="/java-learning/assets/js/10.7ffca642.js"><link rel="prefetch" href="/java-learning/assets/js/11.9997c9ac.js"><link rel="prefetch" href="/java-learning/assets/js/12.12bff65c.js"><link rel="prefetch" href="/java-learning/assets/js/13.fa1d0a12.js"><link rel="prefetch" href="/java-learning/assets/js/14.d0bbb95a.js"><link rel="prefetch" href="/java-learning/assets/js/15.16bae4d6.js"><link rel="prefetch" href="/java-learning/assets/js/16.7193cf44.js"><link rel="prefetch" href="/java-learning/assets/js/17.2578aa30.js"><link rel="prefetch" href="/java-learning/assets/js/18.256cea88.js"><link rel="prefetch" href="/java-learning/assets/js/19.53db1904.js"><link rel="prefetch" href="/java-learning/assets/js/20.bc35f729.js"><link rel="prefetch" href="/java-learning/assets/js/21.0f307412.js"><link rel="prefetch" href="/java-learning/assets/js/22.cdc7a37b.js"><link rel="prefetch" href="/java-learning/assets/js/23.6b0379a8.js"><link rel="prefetch" href="/java-learning/assets/js/24.93411669.js"><link rel="prefetch" href="/java-learning/assets/js/25.980c5483.js"><link rel="prefetch" href="/java-learning/assets/js/26.34693517.js"><link rel="prefetch" href="/java-learning/assets/js/27.fe06a042.js"><link rel="prefetch" href="/java-learning/assets/js/28.2796c1f0.js"><link rel="prefetch" href="/java-learning/assets/js/29.bb8f9f08.js"><link rel="prefetch" href="/java-learning/assets/js/3.1c3491b5.js"><link rel="prefetch" href="/java-learning/assets/js/31.a01e7bf0.js"><link rel="prefetch" href="/java-learning/assets/js/32.824435b6.js"><link rel="prefetch" href="/java-learning/assets/js/33.35871a98.js"><link rel="prefetch" href="/java-learning/assets/js/34.d4bec5fe.js"><link rel="prefetch" href="/java-learning/assets/js/35.c2fd4c53.js"><link rel="prefetch" href="/java-learning/assets/js/36.619ede2c.js"><link rel="prefetch" href="/java-learning/assets/js/37.b19ce17c.js"><link rel="prefetch" href="/java-learning/assets/js/38.ecbf9d5e.js"><link rel="prefetch" href="/java-learning/assets/js/39.cde36814.js"><link rel="prefetch" href="/java-learning/assets/js/4.5d2c294a.js"><link rel="prefetch" href="/java-learning/assets/js/40.0e271850.js"><link rel="prefetch" href="/java-learning/assets/js/41.6f70406e.js"><link rel="prefetch" href="/java-learning/assets/js/42.f065265c.js"><link rel="prefetch" href="/java-learning/assets/js/43.bc6d04eb.js"><link rel="prefetch" href="/java-learning/assets/js/44.632dfc71.js"><link rel="prefetch" href="/java-learning/assets/js/45.604b7fcc.js"><link rel="prefetch" href="/java-learning/assets/js/46.bfbcaa35.js"><link rel="prefetch" href="/java-learning/assets/js/47.a07adb97.js"><link rel="prefetch" href="/java-learning/assets/js/5.7053ea66.js"><link rel="prefetch" href="/java-learning/assets/js/6.c45f153e.js"><link rel="prefetch" href="/java-learning/assets/js/7.b85c48ce.js"><link rel="prefetch" href="/java-learning/assets/js/8.d046468c.js"><link rel="prefetch" href="/java-learning/assets/js/9.30751c28.js">
    <link rel="stylesheet" href="/java-learning/assets/css/0.styles.dcc29016.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/java-learning/" class="home-link router-link-active"><!----> <span class="site-name">Java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://kai-keng.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://kai-keng.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/spring-boot/" class="sidebar-heading clickable"><span>Spring Boot</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/spring-cloud/" class="sidebar-link">Spring Cloud</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/mysql/" class="sidebar-heading clickable"><span>MySQL</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/collection/" class="sidebar-link">集合框架</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/jvm/" class="sidebar-heading clickable router-link-active open"><span>JVM</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-learning/jvm/runtime-data-area.html" class="sidebar-link">运行时数据区</a></li><li><a href="/java-learning/jvm/run-java.html" class="sidebar-link">Java文件运行过程及对象的创建和访问</a></li><li><a href="/java-learning/jvm/class-loader.html" aria-current="page" class="active sidebar-link">类加载器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-learning/jvm/class-loader.html#类加载流程" class="sidebar-link">类加载流程</a></li><li class="sidebar-sub-header"><a href="/java-learning/jvm/class-loader.html#类何时被初始化" class="sidebar-link">类何时被初始化</a></li><li class="sidebar-sub-header"><a href="/java-learning/jvm/class-loader.html#多个类加载器的类加载顺序" class="sidebar-link">多个类加载器的类加载顺序</a></li><li class="sidebar-sub-header"><a href="/java-learning/jvm/class-loader.html#双亲委派机制" class="sidebar-link">双亲委派机制</a></li><li class="sidebar-sub-header"><a href="/java-learning/jvm/class-loader.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/java-learning/jvm/gc.html" class="sidebar-link">垃圾收集</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/multi-thread/" class="sidebar-heading clickable"><span>多线程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java-learning/design-pattern/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/java-learning/internet/" class="sidebar-link">网络</a></li><li><a href="/java-learning/materials/" class="sidebar-link">相关资料</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="类加载器"><a href="#类加载器" class="header-anchor">#</a> 类加载器</h1> <p>类加载器是JVM必不可少的一个部分，它负责将编译好的class文件加载到JVM虚拟机内部运行时数据区的方法区中来，供程序使用。ClassLoader只负责class文件的加载，而是否能够运行则由 Execution Engine 来决定。</p> <h2 id="类加载流程"><a href="#类加载流程" class="header-anchor">#</a> 类加载流程</h2> <p>类加载器加载流程一共有3个步骤，分别是：加载，链接，初始化。其中链接又分为验证，准备，解析三个步骤。</p> <ul><li><p>加载:</p> <ol><li>将class文件加载到内存</li> <li>将静态的数据结构转换成方法区中的运行时数据结构</li> <li>在堆中生成一个java.lang.Class类对象来代表这个类，作为访问类信息数据的入口</li></ol></li> <li><p>链接</p> <ul><li>验证：确保加载的类符合 JVM 规范和安全，保证被校验类的方法在运行时不会做出危害虚拟机的事件，其实就是一个安全检查。</li> <li>准备：为static变量在方法区中分配内存空间，设置变量的初始值，例如<code>static int a = 3</code>语句，赋初始值为<code>a = 0</code>（注意：准备阶段只设置类中的静态变量（方法区中），不包括实例变量（堆内存中），实例变量是对象初始化时赋值的）。</li> <li>解析：虚拟机将常量池内的符号引用替换为直接引用的过程（符号引用，比如<code>import java.util.ArrayList</code>这就算符号引用，直接引用就是指针或者对象地址，注意引用对象一定是在内存进行）。</li></ul></li> <li><p>初始化：初始化其实就是一个赋值的操作，它会执行一个类构造器的<code>&lt;clinit&gt;()</code>方法。由编译器自动收集类中所有变量的赋值动作，此时准备阶段时的那个<code>static int a = 3</code>的例子，在这个时候就正式赋值为3。</p></li></ul> <h2 id="类何时被初始化"><a href="#类何时被初始化" class="header-anchor">#</a> 类何时被初始化</h2> <p>上面介绍了类的加载流程，那么类什么时候才会被初始化呢？就是以下6种情况：</p> <ul><li>创建类的实例，new对象的时候。</li> <li>访问类或者接口的静态变量，或者对类的静态变量赋值</li> <li>调用类的静态方法</li> <li>反射加载类对象<code>Class.forName(类全路径名)</code></li> <li>子类被初始化的时候，作为父类的自己会被先初始化</li> <li>JVM启动时标明的启动类</li></ul> <h2 id="多个类加载器的类加载顺序"><a href="#多个类加载器的类加载顺序" class="header-anchor">#</a> 多个类加载器的类加载顺序</h2> <p>当有多个类加载器时，每个类只能被一个类加载器初始化一次，不同的类加载器也是有优先级的，有如下加载器：</p> <ol><li><strong>BootStrap ClassLoader</strong>：负责加载<code>$JAVA_HOME</code>中<code>jre/lib/rt.jar</code>里所有的class，由C++实现，不是ClassLoader子类。</li> <li><strong>Extension ClassLoader</strong>：负责加载java平台中扩展功能的一些jar包，包括<code>$JAVA_HOME</code>中<code>jre/lib/*.jar</code>或<code>-Djava.ext.dirs</code>指定目录下的jar包。</li> <li><strong>App ClassLoader</strong>：负责加载classpath中指定的jar包及目录中class。</li> <li><strong>Custom ClassLoader</strong>：属于应用程序根据自身需要自定义的ClassLoader，如tomcat、jboss都会根据j2ee规范自行实现ClassLoader。</li></ol> <p>加载过程中会先检查类是否已经被加载，检查顺序<strong>自底向上</strong>逐层检查，如果发现已加载则不再加载。加载顺序则相反，<strong>自顶向下</strong>。</p> <h2 id="双亲委派机制"><a href="#双亲委派机制" class="header-anchor">#</a> 双亲委派机制</h2> <p>双亲委派机制即当我们一个底层类加载器比如Custom ClassLoader收到了加载一个类的请求的时候，并不会自己直接去加载它，而是委派父类加载器App ClassLoader去完成加载，层层往上委派，只有当父类加载器都反馈自己无法完成加载的时候，才会由子类加载器去尝试加载。</p> <p>这样做可以确保不论用哪个加载器加载类，最终都会委派到最上层的加载器往下层层加载下来，确保不同的类加载器加载的结果一致，避免我们自己的代码影响到了JDK的代码。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ol><li><a href="https://juejin.im/post/6844904048013869064#heading-2" target="_blank" rel="noopener noreferrer">大白话带你认识JVM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/6856958647445291021#heading-1" target="_blank" rel="noopener noreferrer">别再说自己不会JVM了，看完这篇能和面试官扯上半小时<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/gjanyanlig/article/details/6818655" target="_blank" rel="noopener noreferrer">Java类加载器总结<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java-learning/jvm/run-java.html" class="prev">
        Java文件运行过程及对象的创建和访问
      </a></span> <span class="next"><a href="/java-learning/jvm/gc.html">
        垃圾收集
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/java-learning/assets/js/app.19408cb2.js" defer></script><script src="/java-learning/assets/js/2.5d689308.js" defer></script><script src="/java-learning/assets/js/30.de82ee17.js" defer></script>
  </body>
</html>
